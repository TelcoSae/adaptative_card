={
  "createdAt": "2025-09-24T13:36:10.660Z",
  "updatedAt": "2025-10-01T19:22:44.000Z",
  "id": "A0og6g1UVA3zotFs",
  "name": "My workflow 2",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {},
      "id": "1eab8747-a92c-43cd-a63b-65f39df58442",
      "name": "Start",
      "type": "n8n-nodes-base.start",
      "typeVersion": 1,
      "position": [
        -256,
        112
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT Anillo, Equipos, Servicios, Clientes FROM DA_TEST;",
        "options": {}
      },
      "id": "1e6a6946-ee0a-46b4-8276-5031b37f3f7b",
      "name": "Consulta DA_TEST",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        0,
        0
      ]
    },
    {
      "parameters": {
        "functionCode": "const rows = $input.all().map(item => item.json);\n\nconst tableBlocks = rows.map(r => ({\n  \"type\": \"TextBlock\",\n  \"text\": `ðŸ”¹ Anillo: ${r.Anillo} | Equipos: ${r.Equipos} | Servicios: ${r.Servicios} | Clientes: ${r.Clientes}`,\n  \"wrap\": true\n}));\n\nreturn [{ json: { resumenBlocks: tableBlocks } }];"
      },
      "id": "73e7d2aa-1640-4f81-93a0-09b3e2f5b156",
      "name": "Construir Resumen",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        256,
        0
      ]
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT Anillo, Equipo, Servicio FROM DA_Afectacion;",
        "options": {}
      },
      "id": "3795dec5-4441-43a7-b70b-682fa09cbf99",
      "name": "Consulta DA_Afectacion",
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2,
      "position": [
        0,
        208
      ]
    },
    {
      "parameters": {
        "functionCode": "const rows = $input.all().map(item => item.json);\n\nconst grouped = {};\nfor (const r of rows) {\n  if (!grouped[r.Anillo]) grouped[r.Anillo] = [];\n  grouped[r.Anillo].push(`Equipo: ${r.Equipo} | Servicio: ${r.Servicio}`);\n}\n\nconst detailBlocks = Object.entries(grouped).map(([anillo, equipos]) => ({\n  \"type\": \"Container\",\n  \"items\": [\n    { \"type\": \"TextBlock\", \"weight\": \"Bolder\", \"text\": `ðŸ”» Anillo ${anillo}` },\n    { \"type\": \"TextBlock\", \"text\": equipos.join(\"\\n\"), \"wrap\": true, \"spacing\": \"None\" }\n  ]\n}));\n\nreturn [{ json: { detalleBlocks: detailBlocks } }];"
      },
      "id": "39b82b08-db1d-4db3-88be-0ef46772d843",
      "name": "Construir Detalle",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        256,
        208
      ]
    },
    {
      "parameters": {
        "mode": "passThrough",
        "options": {}
      },
      "id": "efbe3f45-94b7-4606-9eb4-3fc3fc12185e",
      "name": "Merge Resumen+Detalle",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2,
      "position": [
        464,
        112
      ]
    },
    {
      "parameters": {
        "functionCode": "const resumen = $json[\"resumenBlocks\"] || [];\nconst detalle = $json[\"detalleBlocks\"] || [];\n\nconst card = {\n  type: \"message\",\n  attachments: [\n    {\n      contentType: \"application/vnd.microsoft.card.adaptive\",\n      contentUrl: null,\n      content: {\n        \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n        \"type\": \"AdaptiveCard\",\n        \"version\": \"1.4\",\n        \"body\": [\n          { \"type\": \"TextBlock\", \"size\": \"Large\", \"weight\": \"Bolder\", \"text\": \"ðŸ“Š Reporte de Anillos Afectados\" },\n          ...resumen,\n          { \"type\": \"TextBlock\", \"size\": \"Medium\", \"weight\": \"Bolder\", \"text\": \"ðŸ“Œ Equipos Afectados\" },\n          ...detalle\n        ]\n      }\n    }\n  ]\n};\n\nreturn [{ json: card }];"
      },
      "id": "81ce8029-3a24-4ba6-82c6-cf0d0beaffcf",
      "name": "Armar Card Final",
      "type": "n8n-nodes-base.function",
      "typeVersion": 1,
      "position": [
        656,
        112
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://outlook.office.com/webhook/REEMPLAZAR",
        "options": {}
      },
      "id": "6c49cfb4-90d1-4ac3-9b0a-d18ab7885f0d",
      "name": "Enviar a Teams",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4,
      "position": [
        864,
        112
      ]
    }
  ],
  "connections": {
    "Start": {
      "main": [
        [
          {
            "node": "Consulta DA_TEST",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consulta DA_TEST": {
      "main": [
        [
          {
            "node": "Construir Resumen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Construir Resumen": {
      "main": [
        [
          {
            "node": "Merge Resumen+Detalle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consulta DA_Afectacion": {
      "main": [
        [
          {
            "node": "Construir Detalle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Construir Detalle": {
      "main": [
        [
          {
            "node": "Merge Resumen+Detalle",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge Resumen+Detalle": {
      "main": [
        [
          {
            "node": "Armar Card Final",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Armar Card Final": {
      "main": [
        [
          {
            "node": "Enviar a Teams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "7960582f-694b-494a-b1b3-78d50eb72a6e",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-09-24T13:36:10.663Z",
      "updatedAt": "2025-09-24T13:36:10.663Z",
      "role": "workflow:owner",
      "workflowId": "A0og6g1UVA3zotFs",
      "projectId": "QdIaKjwyS02MMGZQ",
      "project": {
        "createdAt": "2025-09-11T18:03:44.820Z",
        "updatedAt": "2025-09-11T18:10:14.443Z",
        "id": "QdIaKjwyS02MMGZQ",
        "name": "Soporte Acceso Empresas  Empresas <saf.empresas@claro.com.ar>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-11T18:03:44.820Z",
            "updatedAt": "2025-09-11T18:03:44.820Z",
            "userId": "4facc838-fc29-4888-93e5-fd2ef787b161",
            "projectId": "QdIaKjwyS02MMGZQ",
            "user": {
              "createdAt": "2025-09-11T18:03:44.372Z",
              "updatedAt": "2025-10-08T10:41:47.000Z",
              "id": "4facc838-fc29-4888-93e5-fd2ef787b161",
              "email": "saf.empresas@claro.com.ar",
              "firstName": "Soporte Acceso Empresas",
              "lastName": " Empresas",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-11T18:11:25.739Z",
                "personalization_survey_n8n_version": "1.110.1",
                "automationGoalDevops": [
                  "ticketing-systems-integrations"
                ],
                "companyIndustryExtended": [
                  "telecoms"
                ],
                "companySize": "1000+",
                "companyType": "other",
                "role": "devops",
                "reportedSource": "event"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "qNvPVx6pVl6SWob0",
                "userActivatedAt": 1758135955025,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759778484200
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-08",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}