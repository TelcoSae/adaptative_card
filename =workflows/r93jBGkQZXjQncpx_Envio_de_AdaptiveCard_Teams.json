={
  "createdAt": "2025-09-24T13:17:13.087Z",
  "updatedAt": "2025-09-24T14:06:15.000Z",
  "id": "r93jBGkQZXjQncpx",
  "name": "Envio de AdaptiveCard Teams",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -352,
        -176
      ],
      "id": "7ff98f6d-fba5-487d-ab7f-20ee2699c430",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "jsCode": "const rows = $input.all().map(item => item.json);\n\n// Agrupamos por Anillo para mÃ¡s claridad\nconst grouped = {};\nfor (const r of rows) {\n  if (!grouped[r.Anillo]) grouped[r.Anillo] = [];\n  grouped[r.Anillo].push(`Equipo: ${r.Equipo} | Servicio: ${r.Servicio}`);\n}\n\n// Creamos bloques de texto\nconst detailBlocks = Object.entries(grouped).map(([anillo, equipos]) => {\n  return {\n    \"type\": \"Container\",\n    \"items\": [\n      {\n        \"type\": \"TextBlock\",\n        \"weight\": \"Bolder\",\n        \"text\": `ðŸ”» Anillo ${anillo}`\n      },\n      {\n        \"type\": \"TextBlock\",\n        \"text\": equipos.join(\"\\n\"),\n        \"wrap\": true,\n        \"spacing\": \"None\"\n      }\n    ]\n  };\n});\n\nreturn [\n  {\n    json: {\n      detalleEquipos: detailBlocks\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        0
      ],
      "id": "d2ec8f8e-696e-4fff-8845-40b745b343b4",
      "name": "Construir Detalle Equipos"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT Syslocation, Sysname, Enlace\nFROM DA_AFECTA\nWHERE Syslocation IN (SELECT Anillo FROM DA_TEST);",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -160,
        0
      ],
      "id": "43cbab03-af7d-4ae3-9400-0ce2e884999a",
      "name": "Consulta DA_Afectacion",
      "credentials": {
        "mySql": {
          "id": "BKiIWGM5T5ROjiot",
          "name": "MySQL Eventos"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT Anillo, Equipos, Servicios, Clientes\nFROM DA_TEST",
        "options": {}
      },
      "type": "n8n-nodes-base.mySql",
      "typeVersion": 2.5,
      "position": [
        -160,
        -176
      ],
      "id": "b516c637-b239-4688-adc6-d3738f3d1aae",
      "name": "Consulta MySQL",
      "credentials": {
        "mySql": {
          "id": "BKiIWGM5T5ROjiot",
          "name": "MySQL Eventos"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Tomamos todas las filas que vienen de MySQL\nconst rows = $input.all().map(item => item.json);\n\n// Construimos una lista en formato TextBlock\nconst tableBlocks = rows.map(r => {\n  return {\n    \"type\": \"TextBlock\",\n    \"text\": `ðŸ”¹ Anillo: ${r.Anillo} | Servicios: ${r.Servicios} | Clientes: ${r.Clientes}`,\n    \"wrap\": true\n  }\n});\n\nreturn [\n  {\n    json: {\n      type: \"message\",\n      attachments: [\n        {\n          contentType: \"application/vnd.microsoft.card.adaptive\",\n          contentUrl: null,\n          content: {\n            \"$schema\": \"http://adaptivecards.io/schemas/adaptive-card.json\",\n            \"type\": \"AdaptiveCard\",\n            \"version\": \"1.4\",\n            \"body\": [\n              {\n                \"type\": \"TextBlock\",\n                \"size\": \"Large\",\n                \"weight\": \"Bolder\",\n                \"text\": \"ðŸ“Š Reporte DA_AFECTA\"\n              },\n              {\n                \"type\": \"TextBlock\",\n                \"text\": \"Bajada de datos desde MySQL:\",\n                \"wrap\": true\n              },\n              ...tableBlocks\n            ]\n          }\n        }\n      ]\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        32,
        -176
      ],
      "id": "f401481b-81bd-4a21-82f8-a4059c258905",
      "name": "Construir AdaptiveCard"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://claroaup.webhook.office.com/webhookb2/839216bf-f91d-498b-b826-575f025fbea2@05bfea77-f19c-471d-afa2-0c9093af8bdb/IncomingWebhook/819a83ad25b74ef4a0c1bc247dfe9725/f39fde1d-9a0a-4812-b7af-999f97995f52/V2w62Yq-MAw3sSHPw8UBCVWE4epFjOxhZpmGL0As9cjHQ1",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{$json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        224,
        -176
      ],
      "id": "dc424872-fd8b-4fe9-afff-1cbd31e55f66",
      "name": "Enviar a Teams"
    }
  ],
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Consulta MySQL",
            "type": "main",
            "index": 0
          },
          {
            "node": "Consulta DA_Afectacion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consulta DA_Afectacion": {
      "main": [
        [
          {
            "node": "Construir Detalle Equipos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Consulta MySQL": {
      "main": [
        [
          {
            "node": "Construir AdaptiveCard",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Construir AdaptiveCard": {
      "main": [
        [
          {
            "node": "Enviar a Teams",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enviar a Teams": {
      "main": [
        []
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {},
  "versionId": "f7028112-1cb1-4bdf-9c2a-68e1dbd6b72e",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-09-24T13:17:13.090Z",
      "updatedAt": "2025-09-24T13:17:13.090Z",
      "role": "workflow:owner",
      "workflowId": "r93jBGkQZXjQncpx",
      "projectId": "QdIaKjwyS02MMGZQ",
      "project": {
        "createdAt": "2025-09-11T18:03:44.820Z",
        "updatedAt": "2025-09-11T18:10:14.443Z",
        "id": "QdIaKjwyS02MMGZQ",
        "name": "Soporte Acceso Empresas  Empresas <saf.empresas@claro.com.ar>",
        "type": "personal",
        "icon": null,
        "description": null,
        "projectRelations": [
          {
            "createdAt": "2025-09-11T18:03:44.820Z",
            "updatedAt": "2025-09-11T18:03:44.820Z",
            "userId": "4facc838-fc29-4888-93e5-fd2ef787b161",
            "projectId": "QdIaKjwyS02MMGZQ",
            "user": {
              "createdAt": "2025-09-11T18:03:44.372Z",
              "updatedAt": "2025-10-08T10:41:47.000Z",
              "id": "4facc838-fc29-4888-93e5-fd2ef787b161",
              "email": "saf.empresas@claro.com.ar",
              "firstName": "Soporte Acceso Empresas",
              "lastName": " Empresas",
              "personalizationAnswers": {
                "version": "v4",
                "personalization_survey_submitted_at": "2025-09-11T18:11:25.739Z",
                "personalization_survey_n8n_version": "1.110.1",
                "automationGoalDevops": [
                  "ticketing-systems-integrations"
                ],
                "companyIndustryExtended": [
                  "telecoms"
                ],
                "companySize": "1000+",
                "companyType": "other",
                "role": "devops",
                "reportedSource": "event"
              },
              "settings": {
                "userActivated": true,
                "firstSuccessfulWorkflowId": "qNvPVx6pVl6SWob0",
                "userActivatedAt": 1758135955025,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1759778484200
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2025-10-08",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": []
}